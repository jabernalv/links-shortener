<%- include('partials/header', { title: 'My links', user }) %>
<section class="card bg-base-100 shadow">
  <div class="card-body">
    <h2 class="card-title">Create link</h2>
    <% if (error) { %>
    <div class="alert alert-error"><%= error %></div>
    <% } %>
    <form method="post" action="/links" class="flex flex-col md:flex-row gap-3">
      <label class="input input-bordered flex items-center gap-2 w-full">
        <span>https://</span>
        <input
          class="grow"
          type="url"
          name="url"
          placeholder="example.com/your-long-link"
          required
        />
      </label>
      <label
        class="input input-bordered flex items-center gap-2 w-full md:max-w-sm"
      >
        <span>/s/</span>
        <input
          class="grow"
          type="text"
          name="alias"
          placeholder="alias (optional)"
          pattern="[A-Za-z0-9_-]{3,30}"
          title="3-30 chars: letters, numbers, hyphen and underscore"
        />
      </label>
      <button class="btn btn-primary" type="submit">
        <i class="ti ti-link-plus mr-1"></i>
        Shorten
      </button>
    </form>
    <% if (createdCode) { %>
    <div class="alert alert-success">
      Created: <code>/s/<%= createdCode %></code>
    </div>
    <% } %>
  </div>
</section>

<section class="card bg-base-100 shadow">
  <div class="card-body">
    <h2 class="card-title">Links</h2>
    <% if (!links || links.length === 0) { %>
    <p class="muted">No links yet.</p>
    <% } else { %>
    <div class="overflow-x-auto">
      <table class="table table-zebra">
        <thead>
          <tr>
            <th>Short</th>
            <th>Destination</th>
            <th>Clicks</th>
            <th>Created</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% links.forEach(l => { %>
          <tr>
            <td>
              <a
                class="text-blue-600 underline"
                href="/s/<%= l.code %>"
                target="_blank"
                >/s/<%= l.code %></a
              >
            </td>
            <td class="truncate">
              <a class="link link-primary" href="<%= l.url %>" target="_blank"
                ><%= l.url %></a
              >
            </td>
            <td><%= l.total_clicks || 0 %></td>
            <td><%= formatDate(l.created_at) %></td>
            <td>
              <div class="w-full flex gap-2 justify-end items-center">
                <form
                  id="del-form-<%= l.id %>"
                  method="post"
                  action="/links/<%= l.id %>/delete"
                  class="inline-block"
                ></form>
                <button
                  class="btn btn-ghost btn-sm btn-square text-error no-underline"
                  type="button"
                  title="Delete"
                  aria-label="Delete"
                  data-open-modal="confirm-<%= l.id %>"
                >
                  <i class="ti ti-trash"></i>
                </button>
                <a
                  class="btn btn-ghost btn-sm btn-square text-success no-underline"
                  href="/links/<%= l.id %>/stats"
                  title="Statistics"
                  aria-label="Statistics"
                >
                  <i class="ti ti-chart-bar"></i>
                </a>
                <a
                  class="btn btn-ghost btn-sm btn-square no-underline"
                  href="/links/<%= l.id %>/qr.png"
                  title="QR"
                  aria-label="QR"
                  target="_blank"
                >
                  <i class="ti ti-qrcode"></i>
                </a>
              </div>

              <dialog id="confirm-<%= l.id %>" class="modal">
                <div class="modal-box">
                  <h3 class="font-bold text-lg">Confirm deletion</h3>
                  <p class="py-4">Are you sure you want to delete this link?</p>
                  <div class="modal-action">
                    <form method="dialog">
                      <button class="btn" title="Cancel" aria-label="Cancel">
                        <i class="ti ti-x mr-1"></i>
                        Cancel
                      </button>
                    </form>
                    <button
                      class="btn btn-error"
                      data-submit="#del-form-<%= l.id %>"
                      title="Delete"
                      aria-label="Delete"
                    >
                      <i class="ti ti-trash mr-1"></i>
                      Delete
                    </button>
                  </div>
                </div>
              </dialog>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <% } %>
  </div>
</section>
<%- include('partials/footer') %>
